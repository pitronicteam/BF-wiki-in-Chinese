# 解锁顺序与安全

## 开关解锁

为解锁配置一个AUX通道，它将自动选择一个默认的略微超过解锁有效范围（在配置程序“模式”选项卡内配置）的范围，此范围的上限是有效范围的上限加一“步长”（25us），下限是有效范围的下限减一“步长”。这是一项安全性功能，可以确保通道值在上下限附近时不会导致意外解锁。

请注意，此默认值会被接收机的第一个数据值所覆盖，因此接收机初始化失败或某些故障保护功能可能仍会造成意外解锁。

## 意外解锁预防

Betaflight 3.2（及更高版本）提供了在飞行器无法解锁时相关的详细故障排除信息。

可以通过以下方式获取此信息：

* CLI
* Betaflight OSD
* 蜂鸣器
* Betaflight配置程序

部分无法解锁的情形是为了帮助防止由于接收机系统配置不正确，接收链路不可靠/质量差及因用户错误而导致的意外解锁。

这些导致飞行器无法解锁的原因被编码成一组标志（请参见[runtime_config.h](https://github.com/betaflight/betaflight/blob/master/src/main/fc/runtime_config.h)）。

### CLI

可以通过status命令查看标志。

某些闪存空间有限的飞控目标将仅展示这些标志的16进制数字。在这种情况下，当前激活的禁止解锁标志必须从`runtime_config.h`中的`armingDisableFlags_e`枚举中派生出来（请确保所查看的文件的版本与固件版本相匹配）。

### 蜂鸣器

当尝试解锁失败时，如果飞控板连有蜂鸣器，那么它将发出警告信号，以指示当前无法解锁的最重要（最低标志编号）原因。

警告信号如下：

* 五声短促的“注意”音；
* 若干次（也有可能为0次）长哔音；
* 间隔很长的若干次（也有可能为0次）的短哔音。

禁止解锁标志的标号可以通过下列公式计算：(5 \* <长哔音次数>) + <短哔音次数>

例如：

* 1声长 2声短 = 7
* 2声长 = 10

### 禁止解锁标志说明

每个标志的含义和您应该采取的（可能）解决问题的措施。

本列表应该与`master`分支中的代码（`src/main/FC/runtime_config.h`中的`armingDisableFlags_e`）保持一致，因此可用于根据数字查找对应标志，但如果运行的是旧版本固件，您将需要根据上述描述，自行检查禁止解锁标志。



| 名称             | 描述                                 | 提示音 | 提示音 | 提示音     | 提示音 | 提示音 | 提示音  | 应采取的措施                                |
| -------------- | ---------------------------------- | --- | --- | ------- | --- | --- | ---- | ------------------------------------- |
|                |                                    | 3.2 | 3.3 | 3.4/3.5 | 4.0 | 4.1 | 4.2+ |                                       |
| `NOGYRO`       | 未检测到陀螺仪                            | 1   | 1   | 1       | 1   | 1   | 1    | 您可能有硬件故障，如果以前的版本的固件可以工作，则可能是固件问题      |
| `FAILSAFE`     | 已触发失控保护                            | 2   | 2   | 2       | 2   | 2   | 2    | 纠正故障状况，然后重试                           |
| `RXLOSS`（1）    | 未检测到有效的接收器信号                       | 3   | 3   | 3       | 3   | 3   | 3    | 您的接收器有故障或没有与发射器形成有效链接                 |
| `BADRX`（1）     | 您的接收器刚刚从接收器失控保护中恢复，但解锁开关仍处于激活状态    | 4   | 4   | 4       | 4   | 4   | 4    | 将解锁开关拨动至锁定档位                          |
| `BOXFAILSAFE`  | “ 失控保护”开关已激活                       | 5   | 5   | 5       | 5   | 5   | 5    | 请查阅`FAILSAFE`                         |
| `RUNAWAY`      | 预防起飞失控                             |     | 6   | 6       | 6   | 6   | 6    | 上锁以清除此情况                              |
| `CRASH`        | 发生坠机                               |     |     |         |     | 7   | 7    | 上锁以清除此情况                              |
| `THROTTLE`     | 油门通道过高                             | 6   | 7   | 7       | 7   | 8   | 8    | 将油门降低至`min_check`以下                   |
| `ANGLE`        | 飞行器不（足够）水平                         | 7   | 8   | 8       | 8   | 9   | 9    | 将飞船水平调整到`small_angle`以下（默认为25）        |
| `BOOTGRACE`    | 开机后解锁太快                            | 8   | 9   | 9       | 10  | 10  | 10   | 等`pwr_on_arm_grace`秒（默认为5秒）           |
| `NOPREARM`     | 撤防后未激活预备开关或未切换预备                   | 9   | 10  | 10      | 10  | 11  | 11   | 拨动预解锁开关                               |
| `LOAD`         | 系统负载过高，无法安全飞行                      | 10  | 11  | 11      | 11  | 12  | 12   | 重新配置并禁用相关功能                           |
| `CALIB`        | 传感器校准仍在进行中                         | 11  | 12  | 12      | 12  | 13  | 13   | 等待传感器校准完成                             |
| `CLI`          | CLI处于活动状态                          | 12  | 13  | 13      | 13  | 14  | 14   | 退出CLI                                 |
| `CMS`          | CMS（配置菜单）处于活动状态-通过OSD或其他设备显示       | 13  | 14  | 14      | 14  | 15  | 15   | 退出CMS（或OSD菜单）                         |
| `OSD`          | OSD菜单处于活动状态                        | 14  | 15  | 16      |     |     |      | 退出OSD菜单                               |
| `BST`          | 黑羊遥测设备（例如TBS Core Pro）已上锁并无法解锁     | 15  | 16  | 16      | 15  | 16  | 16   | 请参阅您的硬件手册                             |
| `MSP`          | MSP连接处于活动状态，可能是已经连接了Betaflight配置程序 | 16  | 17  | 17      | 16  | 17  | 17   | 终止与Betaflight 配置程序的连接（断开连接）           |
| `PARALYZE`     | 瘫痪模式已激活                            |     |     | 18      | 17  | 18  | 18   | 重新启动/重置飞控板                            |
| `GPS`          | 已配置GPS救援模式，但尚未定位到所需的卫星数量           |     |     | 19      | 18  | 19  | 19   | 等待GPS定位成功，或启用无需GPS定位即可解锁功能，或禁用GPS救援模式 |
| `RESCUE_SW`    | GPS救援开关处于激活位置                      |     |     |         | 19  | 20  | 20   | 关闭GPS救援开关以解锁                          |
| `RPMFILTER`（2） | 基于电机RPM的滤波器无法工作                    |     |     |         | 21  | 21  | 21   | 一个或多个ESC无法提供有效的RPM遥测                  |
| `REBOOT_REQD`  | 需要重启                               |     |     |         |     | 22  | 22   | 重新启动飞行控制器，以使设置更改生效                    |
| `DSHOT_BBANG`  | DSHOT Bitbang无法正常工作                |     |     |         |     | 23  | 23   | （3）                                   |
| `NO_ACC_CAL`   | 需要校准加速度计                           |     |     |         |     |     | 24   | 校准加速度计或禁用调用加速度计的功能                    |
| `MOTOR_PROTO`  | ESC/电机协议未配置                        |     |     |         |     |     | 25   | 在“配置”选项卡上选择要使用的ESC/电机协议。              |
| `ARMSWITCH`    | 手臂开关处于不安全位置                        | 17  | 18  | 20      | 21  | 24  | 26   | 将解锁开关拨动至解锁档位                          |

（1）这些标志可能会在飞行过程中出现在Betaflight OSD上，以作为提醒您的遥控系统出现故障或正处于失控边缘的警告。请像对待“RSSI信号严重不足”警告一样对待它。

（2）若启用了基于RPM回传的滤波器，但是有一个或多个ESC无法提供有效的Dshot遥测信息。请检查ESC是否支持双向Dshot并安装对应的固件。

（3）若Bitbang Dshot无法正常工作，无法控制电机，则可能是由于BitBang计时器与飞控上启用的其他功能发生冲突所致。
