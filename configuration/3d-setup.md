# 3D设置

此页面仍在建设中，用于概述如何在多旋翼上设置3D模式，并列出重要且容易遗漏的步骤以避免发生事故。

有关Dshot的特定信息，请参阅底部部分。

本文从[Hwurzburg的issue](https://github.com/cleanflight/cleanflight/issues/1032)及[相关PR](https://github.com/cleanflight/cleanflight/pull/1034)中获取了相关信息

第一步：获取多旋翼飞机，并安装具有反向/双向功能的电调

第二步：阅读所需的信息和设置，了解正在发生的事情并在装上螺旋桨之前在测试台上测试/验证一切。在3D模式下发生用户设置错误并导致事故的可能性是原来的两倍

第三步：练习练习练习！最重要的是，玩的开心！

需要的信息：

当通过配置程序或CLI命令启用3D模式时，将允许使用双向电调进行操作，通过电机的正反转来产生正推力或负推理来提供倒置和正置操作。您可能需要更改电机线序来使电机旋转方向正确，请查看电调手册进行确认。

油门最低对应全速反转，油门最高对应全速正转。油门归中将对应零油门。

使用开关来解锁是3D飞行的必备条件，可以在配置程序内的模式选项卡中进行设置。由于显而易见的原因，motor_stop和摇杆解锁在3D模式下无法生效。

仅当油门杆居中且解锁开关激活时才会解锁。剪辑将立即以`3d_deadband_low`或`3d_deadband_high`进行旋转，具体取决于油门位置是是否高于或低于`mid_rc`。

如果启用了`disarm_kill_switch`，那么使用开关上锁电机将立刻停转，且不受油门杆位的影响。该参数默认启用。

强烈建议使用3D螺旋桨来获得合理且相等的正反转推力。

如果电调支持，则Oneshot在此模式下可用。

设置：

在固件中启用3D模式：

这可以通过在配置软件中勾选3D模式，或者通过CLick命令来完成。

将电调设置为3D模式：

请翻阅您的电调说明书以了解如何才能开启双向模式。

在校准前先设置最大油门和最低油门。

* BLHeli电调：\
  使用（BLHeli配置程序中的Norm/reverse/bidirectional滑块）将最大PWM设置接收机油门通道上的最大输出值（通常为2000μs），将最小PWM设置为最小值（通常为1000μs），并将中位值设置为1500μs。如果电调的输入值位于中点死区范围内，则电调将不会驱动电机旋转。
* KISS 24A电调：\
  要校准油门路径，电调/飞控必须连接到接收机或飞控上。先将油门值推到最大。给电调/飞控上电。如果电机发出蜂鸣声则表示已激活编程模式。现在将油门信号降低到最低（通常为1000μs），等待电调重启（声音信号高-低-高）。现在油门行程已校准，电调/飞控已经可以使用。注意：电调3D模式下的负载是正常模式下的3倍！\
  3D模式：当油门行程按上述流程校准完毕后，3D模式就可以按如下步骤激活：断开电源，将遥控器油门推至最大，接通电源，等待电机蜂鸣。将油门调到中位，等待电调重启（声音信号高-低-高）。现在3D模式已激活。重要的是，只有油门归中才能解锁。停用方法：重新校准油门行程。
* SimonK电调：与BLHeli电调不同，SimonK电调必须编译特定固件才能支持3D模式。\
  要使SimonK电调支持3D模式，必须在编译固件使修改配置文件： `RC_PLUS_REVERSE = 1`\
  另外建议禁用摇杆校准功能，因为无法在运行时重新配置油门中点：`RC_CALIBRATION = 0`\
  默认情况下，SimonK将油门中点(`MID_RC_PLUS`)设置为最小值(`STOP_RC_PULSE`，设置为1060)和最大值(`FULL_RC_PULSE`，设置为1860)之间的中间值——因此该值为1460.您可以根据您的需要更改这些值，但默认情况下他们运行良好。\
  `MID_RC_PLUS == (STOP_RC_PLUS + FULL_RC_PLUS)/2`\
  配置、编译和刷鞋SimonK电调的最常见方法是使用KKFlash工具或Chrome应用程序“RapidFlash”。两者都简化了了编译Atmel MCU的复杂环境。RapidFlash工具比KKFlash更易用。

在CLI中设置以下参数：

`3d_deadband_high`：这是解锁时飞控输出给电调的正向油门的最小值，解锁时飞控输出给电调的正向油门最大值是`max_throttle`。`3d_deadband_high`和`max_throttle`之间的范围是正向油门的输出范围。

`3d_deadband_low`：这是解锁时飞控输出给电调的反向油门的最小值，解锁时飞控输出给电调的反向油门最大值是`min_command`。`3d_deadband_low`和`min_command`之间的范围是反向油门的输出范围。

注意：若要查看`3d_deadband_high`和`3d_deadband_low`的值，可以使用配置程序中的点击选项卡查找最接近的值，该值可以使所有电机在每个方向上一致旋转。这些数字应该与`mid_rc`有相同的间隔，并应该设置的尽可能接近`mid_rc`。`min_rc`位于`3d_deadband_high`和`3d_deadband_low`之间，以便于在油门居中时以相同的速度在同一方向上旋转电机。

`3d_netual`：这是飞控在解锁时发送给电调的输出值。它类似于`mid_command`在正常模式下的工作方式。除非您有特定的理由，否则~~`failsafe_throttle`~~也应该设置得与`3d_teutral`相同。

`failsafe_throttle`：这是在触发失控保护后飞控发送给电调的值。它应该设置的与`3d_neutral`相同，以使得电调可以在飞机失控情况下令电机停转。

3d：这是`mid_rc`附近的油门杆范围，解锁后当油门杆处于这个范围内时，飞控将向电调输出`3d_deadband_high`或`3d_deadband_low`。实际输出取决于油门杆是从`mid_rc`的高侧还是低侧进入死区。

`max_throttle`：飞控输出给电调的最大值。更改`max_throttle`后应重新进行电调行程校准。

`min_command`：飞控输出给电调的最小值。更改`min_command`后应重新进行电调行程校准。

Dshot部分：【需要进一步清理】

电调调参：

BLHeli_S调整：

不论任何测试，请务必带上护目镜（从第四步开始将装上螺旋桨）手持或锁定在测试台上，务必远离易碎易燃等危险品，禁用AirMode，注意观察电机温度，记录下每个测试结果以进行比较。

1. 确保在默认BLHeli_S设置下，电机旋转方向正确、飞控已开启3D模式。
2. 设置怠速值以使得电机在两个方向上刚好旋转，这与在2D模式下设置怠速值的方式相同，但需要测试3D模式的两个方向。
3. 开启Brake on Stop
4. 安装螺旋桨和相关安全设备。使用要用于飞行的螺旋桨，或用于飞行的最终的螺旋桨。
5. 禁用AIRMODE或任何的类似功能
6. 更改电机进角并测试电机换向时的平滑度。这可能很微妙，每个选项（低、中/低、中、中/高、高）都应该测试，通过对各个选项进行来回切换最终确认最佳选项。
7. 改变启动功率以确保换向平滑。这可能也很微妙，但初步测试表明，将启动功率设置得高一些是从失步中快速恢复的最平稳也是最快的方式。
8. 再次检查怠速值，如果换向仍有一些问题，请降低怠速值。
9. 调整PID并悬停测试以确保没有电机过热的问题。
10. 试飞，并确保电机换向情况足够令人满意。如果换向情况并不是很理想，请再次从步骤4开始，并考虑换用较轻的螺旋桨。

如果单个电机严重滞后，请考虑更换电机以查看该问题是否真的与电机有关，或是与电调有关，甚至应考虑更换电机转子或更换全部电机以解决该问题。

