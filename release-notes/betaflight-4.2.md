# Betaflight 4.2

**正好赶上夏天……**

对于我们大多数人来说，现在正是世界各地都正在陆续结束COVID-19封锁的时刻。现在我们可以自豪地宣布，Betaflight 4.2.0正式发布！

这是自我们切换到使用统一目标来支持不同飞控板之后的第三个大版本，并且我们已经尽力使我们的软件框架可以更容易地支持支持这些“统一目标”，用户使用体验更无缝。我们还努力设法将大多数现有飞控目标转换为新格式。这使得我们开发人员可以无需再为新目标付出额外的精力，就能为新的飞控目标添加支持。因此，Betaflight现在支持的目标比以往任何时间都更多（当前我们支持185种不同的飞控目标和飞控板）。

一如既往地，我们的飞行性能优化向导也很忙，并且为Betaflight的飞行性能提供了许多改进。最重要的是，他们改进了默认参数，使得固件调参更容易。

 新的仍在内测阶段的电池压降补偿功能或许是比较吸引飞手兴趣的一项新功能：它可以在单块电池飞行期间内提供更加一致的“打杆感觉”。

最后但并不是最重要的一点，我们还重新设计了陀螺仪控制环路的工作方式，现在它以固定速率运行，此速率与陀螺仪传感器原生数据速率相同。这简化了环路速率的设定，并使得我们能够为许多新型陀螺仪传感器添加驱动支持 - 希望飞控制造商能够对此有所了解，并开始为这些新型陀螺仪设计生产制造令人兴奋的新型飞控。

有关新功能的详细列表请参照下文。 为确保您已安装最新版本的固件，请确保您已安装最新版本的Betaflight配置器，**然后再更新固件**。

为了充分发挥飞行性能，得到全部的性能提升，请阅读[**《4.2调参指南》**](http://mp.weixin.qq.com/s?\__biz=Mzg4OTAzNzM5MA==\&mid=2247485084\&idx=1\&sn=6d34096ceaba40a1b98cd3b7a6cb40b6\&chksm=cff0b1bdf88738abd0570310d1c30e6ce4e13e89fb595c3af8f14816cd95f032ea58463a1280\&scene=21#wechat_redirect)。 如果您从较早版本的Betaflight升级而来，请阅读以下部分，其中包含了您可能需要在配置器中更改的选项列表。\
我们已尽力使此版本没有错误。如果您仍然发现了一些错误，请在Github代码库内打开一个issues向我们报告。

如果您想讨论betaflight，询问配置问题，或者只是想约其他飞行员一起出去玩，您可以加入我们的Facebook群组。

Betaflight还有一个Slack频道。大多数开发人员都在那里，这是一个讨论你在Betaflight上收获新知的好地方，或者您可以去那里咨询非常复杂的配置问题以寻求帮助。

**祝您玩的开心**

### **升级时需要注意的重要信息**

* Betaflight 4.2对下载和安装固件的方式进行了一些更改，Betaflight配置程序10.7.0将支持此功能所需的更改。因此，重要的是，请尽快将您的配置器更新到10.7.0版本（或更高），以获取最新版本固件的安装程序。
* 黑盒日志查看器已更新到3.5.0，以搭配Betaflight 4.2固件一起使用。请尽快更新黑盒日志查看器。
* Betaflight遥控器Lua脚本已更新到1.5.0，以搭配Betaflight 4.2固件一起使用。
* 如您所料，我们已经写好了一篇有关[Betaflight 4.2的详细调参说明。](http://mp.weixin.qq.com/s?\__biz=Mzg4OTAzNzM5MA==\&mid=2247485084\&idx=1\&sn=6d34096ceaba40a1b98cd3b7a6cb40b6\&chksm=cff0b1bdf88738abd0570310d1c30e6ce4e13e89fb595c3af8f14816cd95f032ea58463a1280\&scene=21#wechat_redirect)请遵照调参说明，或使用Betaflight配置程序10.7.0中的已改进的滑块来调整参数。请不要向CLI中直接粘贴早期版本的参数。一些默认设置已更改，并且某些参数将以完全不同的方式来工作，因此旧的Betaflight 4.1中的参数不能很好地工作。
* 刷写新固件或重置当前配置后，将默认禁用电机输出协议。这意味在您尝试解锁之前，必须选择正确的电机协议。但同时，这也解除了早先版本中的预设协议（OneShot125）对PID最大速率的限制，从而预先选择了当前MCU支持的最大PID速率。
* 当启用双向Dshot时，Dshot协议对应的可能最大PID速率将被降低一半，以匹配ESC将RPM数据发送到飞控所花费的时间。特别地，这意味着当您使用Dshot300开启双向Dshot时，最大PID速率将是4k。
* 为偏航旋转恢复功能的阈值添加了一个新模式，此模式会将阈值自动设置为基于当前配置的最大偏航角速度值，并在其顶部添加了一个缓冲区。此新模式将是偏航旋转阈值的默认模式，因为它可供大多数用户安全使用。您仍然可以手动配置偏航旋转阈值。
* 如果您启用了任何需要使用加速度计的功能，现在需要在使用加速度计之前对加速度计进行校准。这是为了防止出现飞控试图使用未经校准的加速度计进行自稳校准的情况出现，因为其或许会导致意外或危险发生。配置程序内将一直显示警告，并禁止解锁，直至您完成加速度计校准。
* 虚拟电流表的计算方式已改为基于混控器中使用的油门值来计算，而不是基于RC信号的油门通道来计算。这意味着该值应用了油门限值和油门增压等功能，从而可以更准确地预测电流和功耗。如果您正在使用虚拟电流表，请在升级固件之后对其再次校准，以确保校准值正确。
* 固件中计算“RSSI dBm”的值已改为使用-130\~0的实际dBm值，而不是以前的130\~0。这意味着，如果您之前使用这个OSD元素，那么必须将osd_rssi_dbm_alarm更改为先前值的负值（例如60改为-60）。
* 由于不建议在多旋翼飞行器上使用摇杆进行解锁与上锁（容易导致意外上锁），因此默认情况下已将其禁用。如果要使用摇杆解锁（后果自负），则必须使用CLI命令 set enable_stick_arming = on 来启用它。
* CLI命令name已被移除，请该用set name = \<name>命令。

### **主要功能更新**

* 完全重写陀螺仪循环，提高了性能，并使其始终按照陀螺仪固有的数据速率运行。
* 增强了对电池压降的补偿算法，从而在整个飞行期间使油门/PID表现更加一致
* 添加了对高级OSD/CMS设备的支持，从而使其具有支持文本或符号高亮显示的能力
* 添加了对FrSkyOSD设备的支持
* 为SPI连线的CC2500芯片（FrSky SPI）添加了对Redpine RC协议的支持

### **次要功能更新**

* 添加了可以在解锁时显示OSD徽标的选项
* 添加了对高级OSD/CMS设备的支持，从而使其具有支持文本或符号高亮显示的能力
* 添加了对FrSkyOSD设备的支持
* 为SPI连线的CC2500芯片（FrSky SPI）添加了对Redpine RC协议的支持
